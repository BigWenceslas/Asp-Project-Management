@model AITECRM.ViewModels.EntrepriseContact
<html>
<head>

    <script src="~/Scripts/highcharts.js"></script>
    <link href="~/Content/highcharts.css" rel="stylesheet" />
    <script>


    </script>
    <title>Aite Crm Rapports Ventes</title>
</head>
<body>
    <h4>
        <div class="container-fluid">
            <div class="row">
                <nav class="col-sm-3 col-md-2 d-none d-sm-block bg-light sidebar">
                    @Html.Partial("Menu")
                </nav>
                <main class="col-sm-9 ml-sm-auto col-md-10 pt-3" role="main" id="Donnees">
                    <br /><br /><br /><br />
                    <h4>
                        Rapports Ventes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<div class="btn-group" role="group" aria-label="Basic example">
                        </div><hr />
                       @Html.Partial("Rapport")
                         &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<div class="btn-group" role="group" aria-label="Basic example">
                        </div>
                    </h4>

                    <div class="table-responsive">
                    </div>


                    <h4></h4>

                    <div id="container" style="width:90%; height:400px;">
@using (Html.BeginForm("VentesPdf", "DalRapports",FormMethod.Post, new { id = "f" }))
{
                            <div class="col-sm-6 form-group">
                                <label>Entreprise</label>
                              @Html.DropDownList("Entreprise", null,"Vide", htmlAttributes: new { @class = "form-control" })
                                
                            </div>
                            <div class="col-sm-6 form-group">
                                <label>Contact</label>
                                @Html.DropDownListFor(Model => Model.ContactId, new SelectList(""), "--Choisir un contact--", new { @class = "form-control" })
                                </div>
                            
                            <div class="col-sm-6 form-group">
                                <label>Categorie</label>
                                @Html.DropDownList("Categorie", null, "Vide", htmlAttributes: new { @class = "form-control" })
                            </div>
                            <div class="col-sm-6 form-group">
                                <label>Produit</label>
                                @Html.DropDownListFor(Model => Model.ProduitId, new SelectList(""), "--Choisir un produit--", new {@class = "form-control" })
                            </div>
                            <div class="col-sm-6 form-group">
                                <label>Prix Min</label>
                                <input type="text" id="Prixinf" name="Prixinf" />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label>Prix Max</label>
                                <input type="text" id="Prixsup" name="Prixsup" />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label>Date Min</label>
                                <input type="text" id="inf" name="inf" />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label>Date Max</label>
                                <input type="text" id="sup" name="sup" />
                            </div>
                            <select name="Export" id="Export" required>
                                <option value="Pdf" id="pdf1">PDF</option>
                                <option value="Excel" id="excel1">Excel</option>
                                <option value="Word" id="word1">Word</option>

                            </select>
                            <button id="pdf" name="pdf" type="submit" class="btn-primary">Exporter</button>
                     }
                        <button id="GetSummary" name="GetSummary" type="submit" class="btn-primary">Previsualiser</button>

                        <script id="employeeSummaryTemplate" type="text/html">
                            <table class="table table-bordered table-condensed">
                                <tr>
                                    <th>Entreprise</th>
                                    <th>Client</th>
                                    <th>Categorie</th>
                                    <th>Produit</th>
                                    <th>Prix</th>
                                </tr>
                                {{#empSummary}}
                                <tr id="tr{{NomEntreprise}}">
                                    <td>{{NomEntreprise}}</td>
                                    <td>{{NomClient}}</td>
                                    <td>{{NomCategorie}}</td>
                                    <td>{{NomProduit}}</td>
                                    <td>{{Prix}}</td>
                                </tr>
                                {{/empSummary}}
                            </table>
                        </script>
                        <div id="summary">
                            <!-- mustache.js output goes here -->
                        </div>
                    </div>



                    <footer>
                        <center><> <strong>Copyright © 2016 Tout droits réservés. Par <a href="http://www.aite-eonsulting.com">Aite Consulting</a>.</strong></center>
                    </footer>
                </main>

            </div>
        </div>
    </h4>
    <script type="text/javascript">

        //var pdf1 = document.getElementById('pdf1');
        //var word1 = document.getElementById('excel1');
        //var excel1 = document.getElementById('word1');
        var exp = document.getElementById('Export');
        exp.addEventListener('change', function () { document.getElementById('f').action = "@Url.Action("Ventes", "DalRapports")" + exp.value;});
   
        $(function () {
            $('#inf').datepicker({
                changeMonth: true,
                dateFormat: 'dd/mm/yy',
                changeYear: true
            });
        });
        $(function () {
            $('#sup').datepicker({
                changeMonth: true,
                dateFormat: 'dd/mm/yy',
                changeYear: true
            });
        });

     </script>

   @section scripts{

 <script type="text/javascript">

 $(document).ready(function () {
     $("#Entreprise").change(function () {
         $.get("/DalRapports/getListContacts", { Entreprise: $("#Entreprise").val() }, function (data) {
             $("#ContactId").empty();
             $.each(data, function (index, row) {
                 $("#ContactId").append("<option value ='" + row.Contact_name + "'>" + row.Contact_name + "</option>")
             });
         });

     });

     $("#Categorie").change(function () {
         $.get("/DalRapports/getVentesJs", { Categorie: $("#Categorie").val() }, function (data) {
             $("#ProduitId").empty();
             $.each(data, function (index, row) {
                 $("#ProduitId").append("<option value ='" + row.Nom + "'>" + row.Nom + "</option>")
             });
         });

     });
 });
    </script>
    <script src="~/Scripts/mustache.js"></script>
    <script src="~/Scripts/jquery-ui-1.10.4.custom.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            $('#GetSummary').click(function () {
                var Entreprise1 = $('#Entreprise').val();
                var Contact1 = $('#ContactId').val();
                var Categorie1 = $('#Categorie').val();
                var Produit1 = $('#ProduitId').val();
                var PInf1 = $('#Prixinf').val();
                var PSup1 = $('#Prixsup').val();
                var Inf1 = $('#inf').val();
                var Sup1 = $('#sup').val();
                $.ajax({
                    url: '@Url.Action("getVentesJs", "DalRapports")', type: "POST", dataType: "json",
                    data: { Entreprise: Entreprise1, ContactId:Contact1, Categorie:Categorie1, ProduitId:Produit1,Prixinf:PInf1,Prixsup:PSup1,inf:Inf1,sup:Sup1 },
                    success: function (data) {
                        var html = Mustache.to_html($("#employeeSummaryTemplate").html(), { empSummary: data });
                        $("#summary").html(html);
                    },
                    error: function (xhr, status, error) {
                        alert(xhr.responseText);
                        alert(status);
                        alert(error);
                    }
                });

            });
        });

    </script>
        }

</body>
</html>



